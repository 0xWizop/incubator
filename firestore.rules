rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper function to check if user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // Users collection
    // - Authenticated users can read any user (for leaderboard)
    // - Users can write their own document
    match /users/{userId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Trades collection
    // - Authenticated users can read/create trades
    match /trades/{tradeId} {
      allow read, create: if isAuthenticated();
    }
    
    // Rewards collection
    // - Authenticated users can read/write rewards
    match /rewards/{userId} {
      allow read, write: if isAuthenticated();
    }
    
    // Referrals collection
    // - Anyone authenticated can read (to look up codes)
    // - Authenticated users can create/update referrals
    match /referrals/{code} {
      allow read: if isAuthenticated();
      allow create, update: if isAuthenticated();
    }
    
    // Watchlists collection
    // - Authenticated users can manage their watchlists
    match /watchlists/{userId} {
      allow read, write: if isAuthenticated();
    }
    
    // Alerts collection
    // - Authenticated users can manage their own alerts
    match /alerts/{alertId} {
      allow read, write: if isAuthenticated();
    }
    
    // Tracked Wallets collection
    // - Authenticated users can manage their tracked wallets
    match /trackedWallets/{walletId} {
      allow read, write: if isAuthenticated();
    }

    // Portfolio Snapshots collection
    match /portfolioSnapshots/{snapshotId} {
      allow read, write: if isAuthenticated();
    }

    // Watchlist Followers collection
    match /watchlistFollowers/{followerId} {
      allow read, write: if isAuthenticated();
    }
  }
}
